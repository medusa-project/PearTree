##
# Master list of all index schemas.
#

############################### VERSION 0 ####################################
# Requires ES 5.6.
##############################################################################

--- !map:HashWithIndifferentAccess
- agent:
    settings:
      number_of_shards: 1
    mappings:
      agent:
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          description:
            analyzer: english
            fielddata: true
            index_options: offsets
            type: text
          effectively_published:
            type: boolean
          date_last_indexed:
            type: date
          name:
            type: keyword
  collection:
    settings:
      number_of_shards: 1
    mappings:
      collection:
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          access_systems:
            type: keyword
          access_url:
            type: keyword
          allowed_roles:
            type: keyword
            include_in_all: false
          denied_roles:
            type: keyword
            include_in_all: false
          effectively_published:
            type: boolean
          external_id:
            type: keyword
          harvestable:
            type: boolean
          date_last_indexed:
            type: date
          parent_collections:
            type: keyword
            include_in_all: false
          public_in_medusa:
            type: boolean
          published_in_dls:
            type: boolean
          repository_id:
            type: keyword
            include_in_all: false
          repository_title:
            type: keyword
          representative_item:
            type: keyword
            include_in_all: false
          resource_types:
            type: keyword
            include_in_all: false
  item:
    settings:
      number_of_shards: 1
    mappings:
      item:
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          collection:
            type: keyword
            include_in_all: false
          date:
            type: date
          described:
            type: boolean
          effective_allowed_roles:
            type: keyword
            include_in_all: false
          effective_denied_roles:
            type: keyword
            include_in_all: false
          effectively_published:
            type: boolean
          date_last_indexed:
            type: date
          lat_long:
            type: geo_point
          page_number:
            type: short
          parent_item:
            type: keyword
            include_in_all: false
          primary_media_category:
            type: keyword
          published:
            type: boolean
          repository_id:
            type: keyword
            include_in_all: false
          representative_filename:
            type: keyword
          representative_item:
            type: keyword
            include_in_all: false
          structural_sort:
            type: keyword
            include_in_all: false
          subpage_number:
            type: short
          total_byte_size:
            type: long
          variant:
            type: keyword
            include_in_all: false

############################### VERSION 1 ####################################
# This version replaces the "_all" field, which will be going away in ES 6,
# with a "search_all" field populated by the application.
# Requires ES 5.6.
##############################################################################

- agent:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      agent:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          description:
            analyzer: english
            fielddata: true
            index_options: offsets
            type: text
          effectively_published:
            type: boolean
          date_last_indexed:
            type: date
          name:
            type: keyword
          search_all:
            type: text
            store: false
  collection:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      collection:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          access_systems:
            type: keyword
          access_url:
            type: keyword
          allowed_roles:
            type: keyword
          denied_roles:
            type: keyword
          effectively_published:
            type: boolean
          external_id:
            type: keyword
          harvestable:
            type: boolean
          date_last_indexed:
            type: date
          parent_collections:
            type: keyword
          public_in_medusa:
            type: boolean
          published_in_dls:
            type: boolean
          repository_id:
            type: keyword
          repository_title:
            type: keyword
          representative_item:
            type: keyword
          resource_types:
            type: keyword
          search_all:
            type: text
            store: false
  item:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      item:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          collection:
            type: keyword
          date:
            type: date
          date_last_indexed:
            type: date
          described:
            type: boolean
          effective_allowed_roles:
            type: keyword
          effective_denied_roles:
            type: keyword
          effectively_published:
            type: boolean
          lat_long:
            type: geo_point
          page_number:
            type: short
          parent_item:
            type: keyword
          primary_media_category:
            type: keyword
          published:
            type: boolean
          repository_id:
            type: keyword
          representative_filename:
            type: keyword
          representative_item:
            type: keyword
          search_all:
            type: text
            store: false
          structural_sort:
            type: keyword
          subpage_number:
            type: short
          total_byte_size:
            type: long
          variant:
            type: keyword

############################### VERSION 2 ####################################
# This version adds "effective_allowed_role_count" and
# "effective_denied_role_count" fields to the items index, and
# "allowed_role_count" and "denied_role_count" fields to the collections
# index.
# Requires ES 5.6.
##############################################################################

- agent:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      agent:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          description:
            analyzer: english
            fielddata: true
            index_options: offsets
            type: text
          effectively_published:
            type: boolean
          date_last_indexed:
            type: date
          name:
            type: keyword
          search_all:
            type: text
            store: false
  collection:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      collection:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          access_systems:
            type: keyword
          access_url:
            type: keyword
          allowed_role_count:
            type: short
          allowed_roles:
            type: keyword
          denied_role_count:
            type: short
          denied_roles:
            type: keyword
          effectively_published:
            type: boolean
          external_id:
            type: keyword
          harvestable:
            type: boolean
          date_last_indexed:
            type: date
          parent_collections:
            type: keyword
          public_in_medusa:
            type: boolean
          published_in_dls:
            type: boolean
          repository_id:
            type: keyword
          repository_title:
            type: keyword
          representative_item:
            type: keyword
          resource_types:
            type: keyword
          search_all:
            type: text
            store: false
  item:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      item:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          collection:
            type: keyword
          date:
            type: date
          date_last_indexed:
            type: date
          described:
            type: boolean
          effective_allowed_role_count:
            type: short
          effective_allowed_roles:
            type: keyword
          effective_denied_role_count:
            type: short
          effective_denied_roles:
            type: keyword
          effectively_published:
            type: boolean
          lat_long:
            type: geo_point
          page_number:
            type: short
          parent_item:
            type: keyword
          primary_media_category:
            type: keyword
          published:
            type: boolean
          repository_id:
            type: keyword
          representative_filename:
            type: keyword
          representative_item:
            type: keyword
          search_all:
            type: text
            store: false
          structural_sort:
            type: keyword
          subpage_number:
            type: short
          total_byte_size:
            type: long
          variant:
            type: keyword

############################### VERSION 3 ####################################
# Adds "object_repository_id" to the items index.
# Requires ES 5.6.
##############################################################################

- agent:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      agent:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          description:
            analyzer: english
            fielddata: true
            index_options: offsets
            type: text
          effectively_published:
            type: boolean
          date_last_indexed:
            type: date
          name:
            type: keyword
          search_all:
            type: text
            store: false
  collection:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      collection:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          access_systems:
            type: keyword
          access_url:
            type: keyword
          allowed_role_count:
            type: short
          allowed_roles:
            type: keyword
          denied_role_count:
            type: short
          denied_roles:
            type: keyword
          effectively_published:
            type: boolean
          external_id:
            type: keyword
          harvestable:
            type: boolean
          date_last_indexed:
            type: date
          parent_collections:
            type: keyword
          public_in_medusa:
            type: boolean
          published_in_dls:
            type: boolean
          repository_id:
            type: keyword
          repository_title:
            type: keyword
          representative_item:
            type: keyword
          resource_types:
            type: keyword
          search_all:
            type: text
            store: false
  item:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
    mappings:
      item:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
        - metadata_elements:
            match: dls*
            mapping:
              type: text
              fields:
                keyword:
                  type: keyword
                sort:
                  type: icu_collation_keyword
                  index: false
                  numeric: true
                  language: en
                  strength: quaternary
                  alternate: shifted
        properties:
          collection:
            type: keyword
          date:
            type: date
          date_last_indexed:
            type: date
          described:
            type: boolean
          effective_allowed_role_count:
            type: short
          effective_allowed_roles:
            type: keyword
          effective_denied_role_count:
            type: short
          effective_denied_roles:
            type: keyword
          effectively_published:
            type: boolean
          lat_long:
            type: geo_point
          object_repository_id:
            type: keyword
          page_number:
            type: short
          parent_item:
            type: keyword
          primary_media_category:
            type: keyword
          published:
            type: boolean
          repository_id:
            type: keyword
          representative_filename:
            type: keyword
          representative_item:
            type: keyword
          search_all:
            type: text
            store: false
          structural_sort:
            type: keyword
          subpage_number:
            type: short
          total_byte_size:
            type: long
          variant:
            type: keyword

############################### VERSION 4 ####################################
# Replaces hard-coded fields with dynamic fields.
# Requires ES 5.6.
#
# N.B.: The only reason there are three schemas is that the
# elasticsearch-model gem requires each model class to have its own schema.
# The benefits of this gem are questionable and it would be a good idea to
# look into removing it and consolidating all entities into one schema,
# distinguished by a designated keyword field.
##############################################################################

- agent:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
      # must be kept in sync with ElasticsearchClient::MAX_RESULT_WINDOW
      index.max_result_window: 1000000000
    mappings:
      agent:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
          - metadata_elements:
              match: dls*
              mapping:
                type: text
                copy_to: search_all
                fields:
                  keyword:
                    type: keyword
                  sort:
                    type: icu_collation_keyword
                    index: false
                    numeric: true
                    language: en
                    strength: quaternary
                    alternate: shifted
          - booleans:
              match: b_*
              mapping:
                type: boolean
                store: false
          - dates:
              match: d_*
              mapping:
                type: date
                store: false
          - geo_points:
              match: p_*
              mapping:
                type: geo_point
                store: false
          - integers:
              match: i_*
              mapping:
                type: integer
                store: false
          - keywords:
              match: k_*
              mapping:
                type: keyword
                fields:
                  keyword:
                    type: keyword
                  sort:
                    type: icu_collation_keyword
                    index: false
                    numeric: true
                    language: en
                    strength: quaternary
                    alternate: shifted
          - longs:
              match: l_*
              mapping:
                type: long
                store: false
          - text:
              match: t_*
              mapping:
                type: text
                copy_to: search_all
                store: false
        properties:
          search_all:
            type: text
            store: false
  collection:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
      # must be kept in sync with ElasticsearchClient::MAX_RESULT_WINDOW
      index.max_result_window: 1000000000
    mappings:
      collection:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
          - metadata_elements:
              match: dls*
              mapping:
                type: text
                copy_to: search_all
                fields:
                  keyword:
                    type: keyword
                  sort:
                    type: icu_collation_keyword
                    index: false
                    numeric: true
                    language: en
                    strength: quaternary
                    alternate: shifted
          - booleans:
              match: b_*
              mapping:
                type: boolean
                store: false
          - dates:
              match: d_*
              mapping:
                type: date
                store: false
          - geo_points:
              match: p_*
              mapping:
                type: geo_point
                store: false
          - integers:
              match: i_*
              mapping:
                type: integer
                store: false
          - keywords:
              match: k_*
              mapping:
                type: keyword
                fields:
                  keyword:
                    type: keyword
                  sort:
                    type: icu_collation_keyword
                    index: false
                    numeric: true
                    language: en
                    strength: quaternary
                    alternate: shifted
          - longs:
              match: l_*
              mapping:
                type: long
                store: false
          - text:
              match: t_*
              mapping:
                type: text
                copy_to: search_all
                store: false
        properties:
          search_all:
            type: text
            store: false
  item:
    settings:
      number_of_shards: 1,
      index.query.default_field: search_all
      # must be kept in sync with ElasticsearchClient::MAX_RESULT_WINDOW
      index.max_result_window: 1000000000
    mappings:
      item:
        _all:
          enabled: false
        date_detection: false
        dynamic_templates:
          - metadata_elements:
              match: dls*
              mapping:
                type: text
                copy_to: search_all
                fields:
                  keyword:
                    type: keyword
                  sort:
                    type: icu_collation_keyword
                    index: false
                    numeric: true
                    language: en
                    strength: quaternary
                    alternate: shifted
          - booleans:
              match: b_*
              mapping:
                type: boolean
                store: false
          - dates:
              match: d_*
              mapping:
                type: date
                store: false
          - geo_points:
              match: p_*
              mapping:
                type: geo_point
                store: false
          - integers:
              match: i_*
              mapping:
                type: integer
                store: false
          - keywords:
              match: k_*
              mapping:
                type: keyword
                fields:
                  keyword:
                    type: keyword
                  sort:
                    type: icu_collation_keyword
                    index: false
                    numeric: true
                    language: en
                    strength: quaternary
                    alternate: shifted
          - longs:
              match: l_*
              mapping:
                type: long
                store: false
          - text:
              match: t_*
              mapping:
                type: text
                copy_to: search_all
                store: false
        properties:
          search_all:
            type: text
            store: false
