<% provide :title, @item.title %>
<% provide :body_id, 'admin_items_show' %>
<% provide :active_nav, 'entities' %>

<%= admin_breadcrumb(item: @item) %>

<div class="btn-group pull-right">
  <!-- Edit button -->
  <%= link_to edit_admin_collection_item_path(@item.collection, @item),
              class: 'btn btn-default' do %>
    <i class="fa fa-pencil"></i> Edit
  <% end %>
  <!-- Purge Cached Images button -->
  <%= link_to admin_collection_item_purge_cached_images_path(@item.collection, @item),
              class: 'btn btn-default', method: 'post' do %>
    <i class="fa fa-trash"></i> Purge Cached Images
  <% end %>
  <!-- Sets button -->
  <div class="btn-group">
    <button type="button" class="btn btn-default dropdown-toggle"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-plus"></i>
      Add To Set <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
      <% @item.collection.item_sets.joins(:users).
          where(users: { id: current_user.id }).each do |set| %>
        <li>
          <%= link_to set.name,
                      admin_collection_items_add_items_to_item_set_path(@item.collection,
                                                                        'items[]': @item.repository_id,
                                                                        item_set: set.id),
                      method: :post %>
        </li>
      <% end %>
    </ul>
  </div>
  <!-- View button -->
  <div class="btn-group">
    <button type="button" class="btn btn-default dropdown-toggle"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-eye"></i>
      View <span class="caret"></span>
    </button>
    <ul class="dropdown-menu dropdown-menu-right" role="menu">
      <li>
        <%= link_to item_url(@item, format: :json), target: '_blank' do %>
          <i class="fa fa-code"></i>&nbsp;JSON
        <% end %>
      </li>
      <% if @item.has_iiif_manifest? %>
        <li>
          <%= link_to item_iiif_manifest_path(@item), target: '_blank' do %>
            <i class="fa fa-code"></i>&nbsp;IIIF Presentation Manifest
          <% end %>
        </li>
      <% end %>
      <% if @item.bib_id %>
        <li>
          <%= link_to @item.catalog_record_url, target: '_blank' do %>
            <i class="fa fa-book"></i>&nbsp;&nbsp;Library Catalog Record
          <% end %>
        </li>
      <% end %>
      <% if Rails.env.development? %>
        <li class="divider"></li>
        <li>
          <%= link_to(Configuration.instance.solr_url.chomp('/') + '/' +
                          Configuration.instance.solr_core +
                          "/select?wt=json&indent=true&q=id:#{@item.repository_id}", target: '_blank') do %>
            <i class="fa fa-search"></i>&nbsp;&nbsp;Solr (DEVELOPMENT)
          <% end %>
        </li>
      <% end %>
      <li class="divider"></li>
      <li>
        <%= link_to @item, target: '_blank' do %>
          <i class="fa fa-globe"></i>&nbsp;&nbsp;Public View
        <% end %>
      </li>
    </ul>
  </div>
</div>

<% if @item.parent %>
  <h1 class="pt-compound-title">
    <small><%= link_to @item.parent.title,
                       admin_collection_item_path(@item.parent.collection, @item.parent) %></small>
    <br>&nbsp;&nbsp;&#8627; <%= @item.title %>
  </h1>
<% else %>
  <h1><%= @item.title %>
    <% if @item.subtitle %>
      <br><small><%= @item.subtitle %></small>
    <% end %>
  </h1>
<% end %>

<div class="row">

  <div class="col-sm-2" id="pt-structure">
    <%= admin_structure_of_item(@item) %>
  </div>

  <div class="col-sm-2">
    <div class="pt-thumbnail">
      <%= thumbnail_tag(@item) %>
    </div>
    <ul class="nav nav-pills nav-stacked" role="tablist">
      <li role="presentation" class="active">
        <a href="#pt-system-info" aria-controls="pt-system-info" role="tab" data-toggle="tab">System Info</a>
      </li>

      <li role="presentation">
        <a href="#pt-descriptive-metadata" aria-controls="pt-descriptive-metadata" role="tab" data-toggle="tab">Descriptive Metadata</a>
      </li>

      <li role="presentation">
        <a href="#pt-binaries" aria-controls="pt-binaries" role="tab" data-toggle="tab">
          Binaries <span class="badge"><%= @item.binaries.length %></span></a>
      </li>

      <li role="presentation">
        <a href="#pt-schema-org" aria-controls="pt-schema-org" role="tab" data-toggle="tab">schema.org</a>
      </li>
    </ul>
  </div>

  <div class="col-sm-8">
    <div class="tab-content">

      <div role="tabpanel" class="tab-pane active" id="pt-system-info">
        <%= admin_system_info_as_list(@item) %>
        <%= admin_system_info_as_table(@item) %>
      </div>

      <div role="tabpanel" class="tab-pane" id="pt-descriptive-metadata">
        <div class="alert alert-info">
          Collection metadata profile:
          <%= @item.collection.metadata_profile ?
                  link_to(@item.collection.metadata_profile&.name,
                          admin_metadata_profile_path(@item.collection.metadata_profile)) :
                  'None' %>
        </div>
        <%= admin_item_metadata_as_table(@item) %>
      </div>

      <div role="tabpanel" class="tab-pane" id="pt-binaries">
        <% @item.binaries.each do |bin| %>
          <h2><%= bin.human_readable_master_type %></h2>
          <%= binary_metadata_as_table(bin, admin: true) %>
          <hr>
        <% end %>
      </div>

      <div role="tabpanel" class="tab-pane" id="pt-schema-org">
        <div class="clearfix">
          <div class="pull-right">
            <a href="https://search.google.com/structured-data/testing-tool"
               class="btn btn-default" target="_blank">
              <i class="fa fa-google"></i> Test</a>
          </div>
        </div>
        <pre><%= schema_org_json_ld(@item, pretty_print: true) %></pre>
      </div>
    </div>
  </div>
</div>
