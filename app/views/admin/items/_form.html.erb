<%= form_for([:admin, @item.collection, @item]) do |f| %>
  <div class="pull-right">
    <%= f.submit 'Save Changes', class: 'btn btn-primary' %>
  </div>

  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active">
      <a href="#dl-system-info" aria-controls="dl-system-info" role="tab" data-toggle="tab">System Info</a>
    </li>
    <li role="presentation">
      <a href="#dl-access" aria-controls="dl-access" role="tab" data-toggle="tab">Access</a>
    </li>
    <li role="presentation">
      <a href="#dl-metadata" aria-controls="dl-metadata" role="tab" data-toggle="tab">Metadata</a>
    </li>
  </ul>

  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="dl-system-info">
      <table class="table dl-elements">
        <tbody>
          <tr>
            <td>Published</td>
            <td><%= f.check_box(:published) %></td>
          </tr>
          <tr>
            <td>Variant</td>
            <td>
              <%= f.select(:variant, @variants, { include_blank: true },
                           { class: 'form-control'}) %>
            </td>
          </tr>
          <tr>
            <td>Representative Item ID</td>
            <td>
              <%= f.text_field(:representative_item_repository_id, class: 'form-control') %>
            </td>
          </tr>
          <tr>
            <td>Page Number</td>
            <td>
              <%= f.number_field(:page_number, class: 'form-control') %>
            </td>
          </tr>
          <tr>
            <td>Subpage Number</td>
            <td>
              <%= f.number_field(:subpage_number, class: 'form-control') %>
            </td>
          </tr>
          <tr>
            <td>CONTENTdm Alias ("CISOROOT")</td>
            <td>
              <%= f.text_field(:contentdm_alias, class: 'form-control') %>
              <p class="help-block">Needed only if the item's DLS collection is
                different than its CONTENTdm collection.</p>
            </td>
          </tr>
          <tr>
            <td>CONTENTdm Pointer ("CISOPTR")</td>
            <td>
              <%= f.text_field(:contentdm_pointer, class: 'form-control') %>
            </td>
          </tr>
          <tr>
            <td>Embed Tag</td>
            <td>
              <%= f.text_area(:embed_tag, class: 'form-control') %>
              <p class="help-block">If present, this will override the viewer.</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div role="tabpanel" class="tab-pane" id="dl-access">
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <%= f.label :allowed_roles, 'Allowed Roles' %>
            <%= hidden_field_tag :role_ids, nil,
                                 name: 'item[allowed_role_ids][]' %>
            <% Role.order(:name).each do |role| %>
              <div class="checkbox">
                <label>
                  <%= check_box_tag :role_ids, role.id,
                                    f.object.allowed_roles.pluck(:id).include?(role.id),
                                    name: 'item[allowed_role_ids][]' %>
                  <%= role.name %>
                </label>
              </div>
            <% end %>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <%= f.label :denied_roles, 'Denied Roles' %>
            <%= hidden_field_tag :role_ids, nil,
                                 name: 'item[denied_role_ids][]' %>
            <% Role.order(:name).each do |role| %>
              <div class="checkbox">
                <label>
                  <%= check_box_tag :role_ids, role.id,
                                    f.object.denied_roles.pluck(:id).include?(role.id),
                                    name: 'item[denied_role_ids][]' %>
                  <%= role.name %>
                </label>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div role="tabpanel" class="tab-pane" id="dl-metadata">
      <div class="alert alert-info">Collection metadata profile:
        <%= link_to(@item.collection.metadata_profile.name,
                    admin_metadata_profile_path(@item.collection.metadata_profile)) %>
      </div>

      <table class="table table-striped dl-elements">
        <tbody>
          <% @item.collection.metadata_profile.elements.each do |profile_elem| %>
            <% profile_elem.vocabularies.each do |voc| %>
              <tr>
                <td style="width:20%">
                  <label><%= profile_elem.label %></label>
                  <p class="help-block"><%= voc.name %></p>
                </td>
                <td>
                  <% elements = @item.elements.select{ |e| e.name == profile_elem.name and
                      (e.vocabulary_id == voc.id or (e.vocabulary_id.blank? and voc == Vocabulary.uncontrolled)) } %>
                  <% if elements.any? %>
                    <% elements.each do |elem| %>
                      <%= admin_item_element_edit_tag(profile_elem, elem, voc) %>
                    <% end %>
                  <% else %>
                    <%= admin_item_element_edit_tag(profile_elem, nil, voc) %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>

  </div>

  <div class="pull-right">
    <%= f.submit 'Save Changes', class: 'btn btn-primary' %>
  </div>

<% end %>
