<% provide :title, @item.title %>
<% provide :body_id, 'items_show' %>

<%= breadcrumb(item: @item, context: session[:browse_context],
               context_url: session[:browse_context_url]) %>

<%= qr_code(request.url) %>

<div class="btn-group pull-right">
  <button class="btn btn-danger pt-remove-from-favorites"
          data-item-id="<%= @item.id %>">
    <i class="fa fa-heart-o"></i> Remove From Favorites
  </button>
  <button class="btn btn-default pt-add-to-favorites"
          data-item-id="<%= @item.id %>">
    <i class="fa fa-heart"></i> Add To Favorites
  </button>
  <%= share_button(@item) %>
  <% if @item.bytestreams.any? %>
    <button type="button" class="btn btn-default" data-toggle="modal"
            data-target="#pt-download-modal">
      <i class="fa fa-download"></i> Download</span>
    </button>
  <% end %>
</div>

<% if @item.subclass and @item.subclass == Item::Subclasses::PAGE %>
  <%= item_page_title(@item) %>
  <div class="panel panel-default">
    <div class="panel-body pt-page-nav">

      <!-- this form is never actually submitted -- we are just using the
      form-inline class for convenience -->
      <form method="get" class="form-inline">
        <% if @previous_item %>
          <%= link_to raw('&larr; Previous Page'), @previous_item,
                      class: 'pt-previous-page btn btn-default btn-sm' %>
        <% else %>
          <button disabled class="pt-previous-page btn btn-default btn-sm">
            &larr; Previous Page</button>
        <% end %>

        <%= page_select_menu(@item) %>

        <% if @next_item %>
          <%= link_to raw('Next Page &rarr;'), @next_item,
                      class: 'pt-previous-page btn btn-default btn-sm' %>
        <% else %>
          <button disabled class="pt-next-page btn btn-default btn-sm">
            Next Page &rarr;</button>
        <% end %>
      </form>

    </div>
  </div>
<% else %>
  <%= item_page_title(@item) %>
<% end %>

<%= viewer_for(@item) %>

<% if @relative_parent.key_item or @relative_parent.front_matter_item or
    @relative_parent.index_item %>
  <div class="row">
    <div class="col-sm-4 col-md-3 col-lg-3">
      <%= title_item_panel(@relative_parent, size: 512) %>
      <%= key_item_panel(@relative_parent, size: 512) %>
      <%= front_matter_item_panel(@relative_parent, size: 512) %>
      <%= index_item_panel(@relative_parent, size: 512) %>
    </div>
    <div class="col-sm-8 col-md-9 col-lg-9">
      <%= pages_panel(@pages, @item) %>
    </div>
  </div>
<% else %>
  <%= pages_panel(@pages, @item) %>
<% end %>

<% if @item.full_text.present? %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">Full Text</h2>
    </div>
    <div class="panel-body">
      <pre><%= @item.full_text %></pre>
    </div>
  </div>
<% end %>

<div class="panel panel-default">
  <div class="panel-heading">
    <h2 class="panel-title">Descriptive Info</h2>
  </div>
  <div class="panel-body">
    <%= metadata_as_list(@item) %>
    <%= metadata_as_table(@item) %>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h2 class="panel-title">Technical Info</h2>
  </div>
  <div class="panel-body">
    <%= tech_metadata_as_list(@item) %>
    <%= tech_metadata_as_table(@item) %>
    <% if @item.bib_id %>
      <%= link_to 'Show in Library Catalog',
                  "http://vufind.carli.illinois.edu/vf-uiu/Record/uiu_#{@item.bib_id}" %>
    <% end %>
  </div>
</div>

<% if Rails.env.development? %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">DEVELOPMENT ONLY: Bytestreams</h2>
    </div>
    <div class="panel-body">
      <% if @item.bytestreams.any? %>
        <ul>
          <% @item.bytestreams.each do |bs| %>
            <li>
              <%= bs.type.upcase %>: <%= bs.pathname || bs.url %>
              <% if bs.exists? %>
                <span class="label label-success">OK</span>
              <% else %>
                <span class="label label-danger">MISSING</span>
              <% end %>
            </li>
          <% end %>
        </ul>
      <% else %>
        None
      <% end %>
    </div>
  </div>
<% end %>

</div>

<%= render partial: 'download_panel', locals: { item: @item } %>
