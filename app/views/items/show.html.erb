<% provide :title, @item.title %>
<% provide :body_id, 'items_show' %>

<%= breadcrumb(item: @item, context: session[:browse_context],
               context_url: session[:browse_context_url]) %>

<%= qr_code(request.url) %>

<div class="btn-group pull-right" role="group">
  <button class="btn btn-danger pt-remove-from-favorites"
          data-item-id="<%= @item.repository_id %>">
    <i class="fa fa-heart-o"></i> Remove From Favorites
  </button>

  <button class="btn btn-default pt-add-to-favorites"
          data-item-id="<%= @item.repository_id %>">
    <i class="fa fa-heart"></i> Add To Favorites
  </button>

  <%= share_button(@item) %>

  <div class="btn-group">
    <button type="button" class="btn btn-default dropdown-toggle"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-eye"></i>
      View <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
      <li>
        <%= link_to params.merge(format: :atom), target: '_blank' do %>
          <i class="fa fa-rss"></i>&nbsp;&nbsp;Atom
        <% end %>
      </li>
      <% iiif_url = @item.iiif_url %>
      <% if iiif_url %>
        <li>
          <%= link_to iiif_url, target: '_blank' do %>
            <i class="fa fa-info-circle"></i>&nbsp;&nbsp;IIIF Image Information
          <% end %>
        </li>
      <% end %>
      <li>
        <%= link_to params.merge(format: :json), target: '_blank' do %>
          <i class="fa fa-code"></i>&nbsp;JSON
        <% end %>
      </li>
      <% if @item.bib_id %>
        <li><%= link_to "http://vufind.carli.illinois.edu/vf-uiu/Record/uiu_#{@item.bib_id}",
                        target: '_blank' do %>
            <i class="fa fa-book"></i>&nbsp;&nbsp;Library Catalog Record
          <% end %>
        </li>
      <% end %>
      <li class="divider"></li>
      <li>
        <%= link_to admin_collection_item_path(@item.collection, @item),
                    target: '_blank' do %>
          <i class="fa fa-lock"></i>&nbsp;&nbsp;Admin View
        <% end %>
      </li>
    </ul>
  </div>

  <% if @item.bytestreams.any? %>
    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fa fa-download"></i>
        Download <span class="caret"></span>
      </button>
      <ul class="dropdown-menu dropdown-menu-right" role="menu">
        <% if @item.is_image? %>
          <li>
            <a href="#" onclick="return false;" data-toggle="modal"
                    data-target="#pt-embed-image-modal">Embed Image</a>
          </li>
        <% end %>
        <li>
          <a href="#" onclick="return false;" data-toggle="modal"
                  data-target="#pt-download-modal">Download File</a>
        </li>
      </ul>
    </div>
  <% end %>

  <% mailto = curator_mailto(@item) %>
  <% if mailto %>
    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fa fa-phone"></i>
        Contact <span class="caret"></span>
      </button>
      <ul class="dropdown-menu dropdown-menu-right" role="menu">
        <li>
          <%= link_to 'Email Curator', mailto %>
        </li>
      </ul>
    </div>
  <% end %>

</div>

<% if @item.variant and @item.variant == Item::Variants::PAGE %>
  <%= item_page_title(@item) %>
  <div class="panel panel-default">
    <div class="panel-body pt-page-nav">
      <!-- This form is never actually submitted -- we are just using the
      form-inline class for convenience. -->
      <form method="get" class="form-inline">
        <% if @previous_item %>
          <%= link_to raw('&larr; Previous Page'), @previous_item,
                      class: 'pt-previous-page btn btn-default btn-sm' %>
        <% else %>
          <button disabled class="pt-previous-page btn btn-default btn-sm">
            &larr; Previous Page</button>
        <% end %>

        <%= page_select_menu(@item) %>

        <% if @next_item %>
          <%= link_to raw('Next Page &rarr;'), @next_item,
                      class: 'pt-previous-page btn btn-default btn-sm' %>
        <% else %>
          <button disabled class="pt-next-page btn btn-default btn-sm">
            Next Page &rarr;</button>
        <% end %>
      </form>
    </div>
  </div>
<% else %>
  <%= item_page_title(@item) %>
<% end %>

<!-- If the item's collection's package profile is the free-form profile, and
the current item is not a directory, lay out the viewer and metadata
side-by-side. (IMET-161) -->
<% if @item.collection.package_profile == PackageProfile::FREE_FORM_PROFILE and
    @item.variant != Item::Variants::DIRECTORY %>
  <div class="row">
    <div class="col-md-7 pt-split-viewer">
      <%= viewer_for(@item) %>
    </div>
    <div class="col-md-5">
      <section>
        <%= metadata_section(@item) %>
      </section>
    </div>
  </div>
<% else %>
  <div class="pt-full-viewer">
    <%= viewer_for(@item) %>
  </div>
<% end %>

<% if has_viewer?(@item) %>
  <%= rights_statement(@item.effective_rightsstatements_org_statement,
                       @item.effective_rights_statement) %>
<% end %>

<% if @item.variant == Item::Variants::DIRECTORY %>
  <section id="pt-files-section">
    <%= render partial: 'files' %>
  </section>
<% elsif @item.variant != Item::Variants::FILE %>
  <% if @relative_parent.key_item or @relative_parent.front_matter_item or
      @relative_parent.index_item %>
    <div class="row">
      <div class="col-sm-4 col-md-3 col-lg-3">
        <%= title_item_panel(@relative_parent, size: 512) %>
        <%= key_item_panel(@relative_parent, size: 512) %>
        <%= front_matter_item_panel(@relative_parent, size: 512) %>
        <%= index_item_panel(@relative_parent, size: 512) %>
      </div>
      <div class="col-sm-8 col-md-9 col-lg-9">
        <section id="pt-pages-section">
          <%= render partial: 'pages' %>
        </section>
      </div>
    </div>
  <% else %>
    <section id="pt-pages-section">
      <%= render partial: 'pages' %>
    </section>
  <% end %>
<% end %>

<% if @item.full_text.present? %>
  <section>
    <h2>Full Text</h2>
    <pre><%= @item.full_text %></pre>
  </section>
<% end %>

<% unless has_viewer?(@item) %>
  <%= rights_statement(@item.effective_rightsstatements_org_statement,
                       @item.effective_rights_statement) %>
<% end %>

<% if @item.elements.reject{ |e| e.name == 'title' }.any? and
    @item.collection.package_profile != PackageProfile::FREE_FORM_PROFILE %>
  <section>
    <%= metadata_section(@item) %>
  </section>
<% end %>

<% @item.bytestreams.each do |bs| %>
  <section>
    <h2><%= bs.human_readable_type %> File</h2>
    <%= bytestream_metadata_as_table(bs) %>
  </section>
<% end %>

<section>
  <h2>Technical Info</h2>
  <div class="visible-xs">
    <%= tech_metadata_as_list(@item) %>
  </div>
  <div class="hidden-xs">
    <%= tech_metadata_as_table(@item) %>
  </div>
</section>

<%= render partial: 'cite_panel', locals: { item: @item } %>
<%= render partial: 'download_panel', locals: { item: @item } %>
<%= render partial: 'embed_image_panel', locals: { item: @item } %>

<script type="application/ld+json">
  <%= schema_org_json_ld(@item) %>
</script>