<% provide :title, @collection.title %>
<% provide :body_id, 'collections_show' %>
<% provide :active_nav, 'collections' %>

<%= breadcrumb(collection: @collection) %>

<form method="get" action="<%= collection_items_path(@collection) %>"
      class="form-inline pull-right">
  <div class="input-group">
    <% if @collection.published_in_dls and @authorized %>
      <span class="input-group-addon"><i class="fa fa-search"></i></span>
      <%= search_field_tag :q, params[:q], class: 'form-control', placeholder: 'Search This Collection' %>
      <% if @collection.free_form? %>
        <%= hidden_field_tag(:display, 'leaves') %>
      <% end %>
    <% end %>

    <div class="input-group-btn">
      <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fa fa-eye"></i>
          View <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
          <% if @authorized %>
            <li>
              <%= link_to @permitted_params.merge(format: :json), target: '_blank' do %>
                <i class="fa fa-code"></i>&nbsp;JSON
              <% end %>
            </li>
            <li>
              <%= link_to collection_iiif_presentation_path(@collection), target: '_blank' do %>
                <i class="fa fa-code"></i>&nbsp;IIIF Representation
              <% end %>
            </li>
            <li class="divider"></li>
          <% end %>
          <li>
            <%= link_to admin_collection_path(@collection), target: '_blank' do %>
              <i class="fa fa-lock"></i>&nbsp;&nbsp;Admin View
            <% end %>
          </li>
        </ul>
      </div>
    </div>
  </div>
</form>

<h1><%= collection_page_title(@collection) %></h1>

<% if @representative_image_binary and !@storage_offline %>
  <div class="row">
    <div class="col-sm-6 col-md-7 col-lg-8">
      <%= render partial: 'description' %>
    </div>
    <div class="col-sm-6 col-md-5 col-lg-4">
      <div class="pt-main-image">
        <% if @representative_item %>
          <% if @authorized %>
            <%= link_to @representative_item do %>
              <%= thumbnail_tag(@representative_image_binary, size: 512) %>
            <% end %>
            <%= link_to @representative_item, class: 'pt-title' do %>
              <%= @representative_item.title %>
            <% end %>
          <% else %>
            <%= thumbnail_tag(@representative_image_binary, size: 512) %>
            <%= @representative_item.title %>
          <% end %>
        <% else %>
          <%= thumbnail_tag(@representative_image_binary, size: 512) %>
        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <%= render partial: 'description' %>
<% end %>

<% if @collection.children.count > 0 %>
  <hr>
  <h2>Subcollections</h2>
  <div class="pt-cards">
    <%= entities_as_cards(@collection.children.where(public_in_medusa: true)) %>
  </div>
<% end %>
